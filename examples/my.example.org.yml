---

### configuration variables for my.example.org

# REQUIRED administrator/sudo account username/password
ansible_ssh_user: "CHANGEME"
ansible_become_pass: "CHANGEME"
# ansible_ssh_port: '22'

# REQUIRED default admin username/password for new services/applications
xsrv_default_username: "CHANGEME"
xsrv_default_password: "CHANGEME"

##### OUTGOING MAIL #####
# see roles/common/defaults/main.yml

setup_msmtp: no
# msmtp_host: "smtp.example.com"
# msmtp_username: "CHANGEME"
# msmtp_password: "CHANGEME"
# msmtp_admin_email: "CHANGEME"


##### FIREWALL/FAIL2BAN #####
# see roles/common/defaults/main.yml

# yes/no: setup firewall and fail2ban
setup_firewall: yes

# The default configuration assumes a single network interface, connected to both the LAN, and the Internet
# This works if your server is behind a NAT, or connected to the Internet with a public IP address

# Firewall rules - traffic to/from the local machine
firehol_networks:
  - name: "lan"
    src: "10.0.0.0/8,192.168.0.0/16,172.16.0.0/12" # to/from private IP addresses
    interface: "any"
    allow_input: # incoming connections
      - { name: "ssh", src: "any" } # ssh from LAN
      # - { name: "samba", src: "any" } # samba file sharing
      # - { name: "multicast", src: "any" } # avahi/mdns
    allow_output: # outgoing connections
      - { name: "ping", dst: "any" } # nice to have
      - { name: "dhcp", dst: "any" } # required if dynamic ip addressing
      # - { name: "dns", dst: "any" } # DNS server on LAN
    policy: "RETURN" # forward to the next chain if no rule matches (or DROP)

  - name: "internet"
    src: "any" # to/from any IP address
    interface: "any"
    allow_input:
      - { name: "ssh", src: "any" } # ssh from anywhere
      - { name: "netdata", src: "any" } # monitoring dashboard
      - { name: "http", src: "any" } # web server
      - { name: "https", src: "any" } # web server
      - { name: "ping", src: "any" } # nice to have
      # - { name: "mumble", src: "any" } # mumble voip server
    allow_output:
      - { name: "dns", dst: "any" } # DNS server on WAN
      - { name: "ntp", dst: "any" } # time/date synchronization
      - { name: "http", dst: "any" } # http downloads
      - { name: "https", dst: "any" } # https downloads
      # - { name: "submission", dst: "any" } # outgoing mail/port 587
      # - { name: "submission", dst: "any" } # ssh/git access to anywhere
      # - { name: "imaps", dst: "any" } # nextcloud mail
      # - { name: "all", dst: "any" }
    policy: "RETURN"


##### RSNAPSHOT BACKUP SERVICE #####
# see roles/backup/default/main.yml

rsnapshot_backup_execs:
  - '/opt/xsrv/nextcloud-mysql-dump.sh'
  - '/opt/xsrv/gitea-dump.sh'

rsnapshot_local_backups:
  - '/var/backups/mysql/nextcloud/'
  - '/var/backups/gitea/'

rsnapshot_excludes:
  - '/var/nextcloud/data/updater-*/'
  - '/var/nextcloud/data/appdata_*/'
  - '/var/nextcloud/data/*/cache/'
  - '/var/nextcloud/data/*/thumbnails/'
  - '/var/nextcloud/data/*/files_trashbin/'

##### APACHE WEB SERVER #####
# see roles/lamp/defaults/main.yml

apache_virtualhosts:
  - servername: "{{ inventory_hostname }}"
    documentroot: "/var/www/{{ inventory_hostname }}"
    cert_mode: selfsigned # selfsigned/letsencrypt
    allow_robots: no
    auto_homepage: yes


##### NEXTCLOUD #####
# see roles/nextcloud/defaults/main.yml
nextcloud_user: "{{ xsrv_default_username }}"
nextcloud_password: "{{ xsrv_default_password }}"
nextcloud_db_password: "{{ lookup('password', 'secrets/' + inventory_hostname + '.nextcloud_db_password length=20')}}"
